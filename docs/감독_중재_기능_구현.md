# 감독 연출 지시 기능 (수정됨)

**작성일**: 2026-01-27  
**최종 수정**: 2026-01-27 (수정하기 기능 제거 및 프롬프트 강화)

---

## 📋 구현 개요

감독 모드에서 AI에게 연출 지시를 내릴 수 있는 기능을 구현했습니다. 초기 구현된 "수정하기(재생성)" 기능은 **리얼리티(이미 뱉은 대사는 주워 담을 수 없다)**를 위해 삭제되었으며, 대신 **하단 입력창을 통한 실시간 연출 지시**에 집중합니다. 또한 AI가 감독을 극 중 인물로 착각하지 않도록 **강력한 시스템 프롬프트**를 적용했습니다.

---

## ✅ 주요 변경 사항

### 1. "수정하기" 버튼 제거
- 기존: 각 AI 메시지에 호버 시 "수정하기" 버튼 표시, 모달을 통해 지난 대사 수정 가능
- **변경**: **삭제됨**. 연극의 긴장감 유지 및 리얼리티 확보를 위해 지난 대사를 수정하는 기능은 제거했습니다.

### 2. 감독 투명화 (Ghost Director)
AI가 감독을 촬영장의 스태프나 등장인물로 인식하고 대화를 시도하는 문제를 해결하기 위해 시스템 프롬프트를 대폭 강화했습니다.

- **제4의 벽 강화**: 감독, 카메라, 제작진을 절대 쳐다보거나 언급 금지.
- **지시 수용 방식**: 감독의 지시를 "갑자기 떠오른 생각"이나 "자연스러운 상황 변화"로 받아들이도록 세뇌.
- **예시**:
  - 감독: "화내라"
  - AI (기존): (감독을 보며) "네 알겠습니다!" (❌)
  - AI (변경): (갑자기 표정을 찌푸리며) "정말 기분 나쁘네!" (⭕)

---

## 🔧 기술적 세부사항

### Backend (`app/api/chat.py`)

#### `format_persona_for_roleplay`
시스템 프롬프트를 전면 수정하여 다음 내용을 포함했습니다:
- "[🚨 절대 금지 사항]" 섹션 추가
- 감독/스태프 언급 금지, 이모티콘 금지, 상대방 역할 침범 금지

#### `chat` API
- `director_note` 처리 시에도 시스템 메시지로 **"감독에게 대답하지 말고 즉시 연기하라"**는 지침 추가.
- `character_name` 파라미터를 `partner_name`으로 변경하여 의미 명확화.

---

## 🎯 사용 흐름

1. **감독 모드 대화 진행**: AI 캐릭터들이 자동으로 대화.
2. **연출 지시**: 하단 입력창에 `[감독 중재] 더 격정적으로 싸워봐`와 같이 입력.
3. **AI 반응**: 지시 내용을 즉시 반영하여 다음 대사에 적용하되, 감독에게 대답하지 않고 자연스럽게 연기로 표현.

---

**상태**: 구현 완료 및 적용됨.
